<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Camera Artifact Breaker</title>

<style>
:root{
  --bg:#050608;
  --fg:#d9ffe2;
  --neon:#39ff88;
  --border:#1b2a22;
  --muted:#7ccf9a;
  --danger:#ff4d6d;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
header{
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header b{color:var(--neon);letter-spacing:.6px}
main{
  max-width:1200px;
  margin:0 auto;
  padding:12px;
  display:grid;
  gap:12px;
}
.panel{
  border:1px solid var(--border);
  border-radius:16px;
  background:linear-gradient(180deg,#070a0d,#050608);
  padding:12px;
}
.grid{
  display:grid;
  grid-template-columns:360px 1fr;
  gap:12px;
}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
label{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center}
input[type="range"]{width:180px}

button{
  border:1px solid var(--border);
  background:rgba(57,255,136,.08);
  color:var(--fg);
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
}
button:hover{background:rgba(57,255,136,.14)}
button.danger{border-color:rgba(255,77,109,.4);background:rgba(255,77,109,.1)}

.canvasWrap{
  position:relative;
  background:#000;
  border-radius:16px;
  border:1px solid var(--border);
  overflow:hidden;
}
canvas{width:100%;height:auto;display:block}

.badge{
  position:absolute;
  top:10px;left:10px;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  background:rgba(0,0,0,.45);
  border:1px solid rgba(57,255,136,.3);
}
.badge.pause{border-color:rgba(255,77,109,.5)}
.small{font-size:12px;color:var(--muted)}
.divider{height:1px;background:var(--border);margin:10px 0}
</style>
</head>

<body>
<header>
  <div><b>RAGE</b> • Camera Artifact Breaker</div>
  <a href="index.html" style="color:var(--muted);text-decoration:none">← menu</a>
</header>

<main>
<section class="panel">
<div class="grid">

<!-- CONTROLS -->
<div class="panel">
  <div style="font-weight:700">Destruction Controls</div>
  <div class="small">This intentionally abuses the live camera feed.</div>

  <div class="divider"></div>

  <div class="row">
    <label>Tile size
      <input id="tile" type="range" min="6" max="64" value="16">
      <span id="tileV">16</span>
    </label>
  </div>

  <div class="row">
    <label>Break amount
      <input id="break" type="range" min="0" max="100" value="70">
      <span id="breakV">70</span>
    </label>
  </div>

  <div class="row">
    <label>Frame corruption
      <input id="temporal" type="range" min="0" max="100" value="60">
      <span id="tempV">60</span>
    </label>
  </div>

  <div class="row">
    <label>Block drops
      <input id="drop" type="range" min="0" max="100" value="25">
      <span id="dropV">25</span>
    </label>
  </div>

  <div class="row">
    <label>RGB split
      <input id="rgb" type="range" min="0" max="20" value="8">
      <span id="rgbV">8</span>
    </label>
  </div>

  <div class="row">
    <label>Scanlines
      <input id="scan" type="range" min="0" max="100" value="40">
      <span id="scanV">40</span>
    </label>
  </div>

  <div class="divider"></div>

  <div class="row">
    <button id="toggle">⏸ Pause</button>
    <button id="reset" class="danger">✖ Reset</button>
  </div>

  <div class="divider"></div>
  <div class="small">
    Tip: tile 12–20 + break 80 + temporal 70 = “camera dying on impact”.
  </div>
</div>

<!-- CANVAS -->
<div class="canvasWrap">
  <div id="badge" class="badge">LIVE</div>
  <canvas id="c" width="960" height="540"></canvas>
</div>

</div>
</section>
</main>

<script>
(() => {
const $ = id => document.getElementById(id);
const c = $("c");
const ctx = c.getContext("2d",{willReadFrequently:true});
const v = document.createElement("video");

let W = c.width, H = c.height;
let running = true;
let frameHistory = [];
const MAX_FRAMES = 6;

const tile = $("tile"), tileV = $("tileV");
const br = $("break"), brV = $("breakV");
const temp = $("temporal"), tempV = $("tempV");
const drop = $("drop"), dropV = $("dropV");
const rgb = $("rgb"), rgbV = $("rgbV");
const scan = $("scan"), scanV = $("scanV");
const toggle = $("toggle");
const reset = $("reset");
const badge = $("badge");

[tile,br,temp,drop,rgb,scan].forEach(r=>{
  const out = $(r.id+"V");
  const f=()=>out.textContent=r.value;
  r.addEventListener("input",f);f();
});

navigator.mediaDevices.getUserMedia({video:true,audio:false}).then(s=>{
  v.srcObject=s;v.play();
});

function drawScanlines(a){
  if(!a)return;
  ctx.save();
  ctx.globalAlpha = 0.2*(a/100);
  for(let y=0;y<H;y+=2) ctx.fillRect(0,y,W,1);
  ctx.restore();
}

function drawRGB(off){
  if(!off)return;
  ctx.save();
  ctx.globalCompositeOperation="screen";
  ctx.globalAlpha=.2;
  ctx.drawImage(c,-off,0);
  ctx.drawImage(c,off,0);
  ctx.restore();
}

function corrupt(){
  ctx.drawImage(v,0,0,W,H);

  if(frameHistory.length>MAX_FRAMES) frameHistory.shift();
  frameHistory.push(ctx.getImageData(0,0,W,H));

  const ts = +tile.value;
  const chaos = +br.value/100;
  const temporal = +temp.value/100;
  const drops = +drop.value/100;

  for(let y=0;y<H;y+=ts){
    for(let x=0;x<W;x+=ts){
      if(Math.random()<drops*chaos){
        ctx.fillStyle=Math.random()<.3?"#000":"rgba(57,255,136,.25)";
        ctx.fillRect(x,y,ts,ts);
        continue;
      }

      if(Math.random()<temporal && frameHistory.length){
        const f = frameHistory[Math.random()*frameHistory.length|0];
        ctx.putImageData(f,x+(Math.random()*ts-ts/2)*chaos,y, x,y,ts,ts);
        continue;
      }

      if(Math.random()<chaos){
        ctx.drawImage(
          c,
          x,y,ts,ts,
          x+(Math.random()*ts-ts/2)*chaos,
          y+(Math.random()*ts-ts/2)*chaos,
          ts,ts
        );
      }
    }
  }

  drawScanlines(+scan.value);
  drawRGB(+rgb.value);
}

function loop(){
  requestAnimationFrame(loop);
  if(!running) return;
  corrupt();
}

toggle.onclick=()=>{
  running=!running;
  badge.textContent=running?"LIVE":"PAUSED";
  badge.classList.toggle("pause",!running);
  toggle.textContent=running?"⏸ Pause":"▶ Resume";
};

reset.onclick=()=>{
  frameHistory=[];
};

loop();
})();
</script>
</body>
</html>